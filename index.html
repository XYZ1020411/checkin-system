<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>兌換系統</title>
    <style>
        .hidden { display: none; }
        .container { margin: 20px; }
    </style>
</head>
<body>
    <div class="container" id="loginContainer">
        <h2>登錄</h2>
        <input type="text" id="username" placeholder="用戶名">
        <button onclick="login()">登錄</button>
    </div>

    <div class="container hidden" id="customerContainer">
        <h2>客戶功能</h2>
        <button onclick="checkIn()">每日簽到</button>
        <button onclick="viewPoints()">查看點數</button>
        <button onclick="lottery()">抽獎</button>
        <input type="text" id="redeemCodeCustomer" placeholder="輸入兌換碼">
        <button onclick="redeemCodeCustomer()">兌換兌換碼</button>
        <button onclick="viewRedeemItems()">查看可兌換物品</button>
        <p id="customerMessage"></p>
    </div>

    <div class="container hidden" id="adminContainer">
        <h2>管理員功能</h2>
        <button onclick="viewUsers()">查看所有用戶</button>
        <input type="text" id="redeemCode" placeholder="輸入兌換碼">
        <input type="number" id="points" placeholder="增加點數" min="1">
        <button onclick="addRedeemCode()">新增兌換碼</button>
        <input type="text" id="itemName" placeholder="新增可兌換物品">
        <input type="number" id="itemCost" placeholder="物品所需點數" min="1">
        <button onclick="addRedeemItem()">新增可兌換物品</button>
        <h3>通知列表</h3>
        <ul id="notificationList"></ul>
        <div id="userList" class="hidden"></div>
    </div>

    <script>
        let currentUser = null;
        let redeemItems = {};
        let registeredUsers = {};
        let notifications = [];

        function login() {
            const username = document.getElementById('username').value;
            if (!username) {
                alert("請輸入用戶名！");
                return;
            }

            // 模擬用戶登錄
            currentUser = { username: username, points: 100, isAdmin: username === "admin" };
            registeredUsers[username] = currentUser;
            localStorage.setItem('registeredUsers', JSON.stringify(registeredUsers));

            document.getElementById('loginContainer').classList.add('hidden');
            if (currentUser.isAdmin) {
                document.getElementById('adminContainer').classList.remove('hidden');
            } else {
                document.getElementById('customerContainer').classList.remove('hidden');
            }
        }

        function viewRedeemItems() {
            const items = Object.keys(redeemItems);
            if (items.length === 0) {
                document.getElementById('customerMessage').innerText = "目前沒有可兌換的物品！";
                return;
            }

            const itemList = items.join(", ");
            document.getElementById('customerMessage').innerText = `可兌換物品: ${itemList}`;
        }

        function addRedeemItem() {
            if (!currentUser || !currentUser.isAdmin) {
                alert("您沒有權限訪問此功能！");
                return;
            }

            const itemName = document.getElementById('itemName').value;
            const itemCost = parseInt(document.getElementById('itemCost').value);

            if (!itemName || isNaN(itemCost) || itemCost <= 0) {
                alert("請輸入有效的物品名稱和所需點數！");
                return;
            }

            redeemItems[itemName] = itemCost; // 儲存物品及其所需點數
            localStorage.setItem('redeemItems', JSON.stringify(redeemItems));
            alert("新增可兌換物品成功！");
        }

        function redeemItem(itemName) {
            if (!currentUser) {
                document.getElementById('customerMessage').innerText = "請先登錄！";
                return;
            }

            const itemCost = redeemItems[itemName];

            if (itemCost) {
                if (currentUser.points < itemCost) {
                    document.getElementById('customerMessage').innerText = "點數不足，無法兌換！";
                    return;
                }

                currentUser.points -= itemCost; // 扣除相應的點數
                registeredUsers[currentUser.username] = currentUser;
                localStorage.setItem('registeredUsers', JSON.stringify(registeredUsers));

                // 通知管理員
                notifyAdmin(currentUser.username, itemName);
                document.getElementById('customerMessage').innerText = `兌換成功！獲得 ${itemName}。`;
            } else {
                document.getElementById('customerMessage').innerText = "物品不存在！";
            }
        }

        function notifyAdmin(customerName, itemName) {
            const notification = `${customerName} 兌換了 ${itemName}`;
            notifications.push(notification);
            localStorage.setItem('notifications', JSON.stringify(notifications));
            updateNotificationList();
        }

        function updateNotificationList() {
            const notificationList = document.getElementById('notificationList');
            notificationList.innerHTML = ""; // 清空列表
            notifications.forEach(notification => {
                const li = document.createElement('li');
                li.textContent = notification;
                notificationList.appendChild(li);
            });
        }

        // 模擬一些初始數據
        redeemItems = {
            "商品A": 20,
            "商品B": 50,
            "商品C": 30
        };
        localStorage.setItem('redeemItems', JSON.stringify(redeemItems));
        notifications = JSON.parse(localStorage.getItem('notifications')) || [];
        updateNotificationList();
    </script>
</body>
</html>
